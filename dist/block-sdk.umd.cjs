(function(a){typeof define=="function"&&define.amd?define(a):a()})(function(){"use strict";var T=Object.defineProperty;var L=(a,n,l)=>n in a?T(a,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[n]=l;var i=(a,n,l)=>L(a,typeof n!="symbol"?n+"":n,l);for(var a=[],n=0;n<256;++n)a.push((n+256).toString(16).slice(1));function l(t,e=0){return(a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]).toLowerCase()}var r,E=new Uint8Array(16);function v(){if(!r&&(r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(E)}var D=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const k={randomUUID:D};function I(t,e,s){if(k.randomUUID&&!e&&!t)return k.randomUUID();t=t||{};var o=t.random||(t.rng||v)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,l(o)}function y(t,e){const s=new ResizeObserver(()=>{if(t){const{width:o,height:u}=t.getBoundingClientRect();e.sendControllerMessage({data:{width:o,height:u}},"resize")}});t&&s.observe(t)}function A(){return window.self!==window.top}function U(t){const e=I(),s=Date.now();window.parent.postMessage({senderBlockId:t.senderBlockId,type:t.type,namespace:t.namespace||"",eventData:{version:2,eventId:e,timestamp:s,playId:"",source:{blockId:t.senderBlockId,blockName:t.blockName,...t.source},payload:{...t.payload,lastUpdatedTimestamp:s},...t.eventData}},"*")}const c={isInIframe:A,sendMessageToHost:U,getUrlParams:t=>new URLSearchParams(window.location.search).get(t),domResizeObserver:y},d={OUTPUT:"output-event",INCOME:"input-event",CONTROLLER:"controller-event",HOST_DATA:"host-data-event",ALX:"alx-event"},g={BLOCK_ID:"block-id"},w="ALX",C={UPDATE_MESSAGE:"UPDATE_MESSAGE",DISPLAY_MESSAGE:"DISPLAY_MESSAGE"},b=class b{constructor(e,s){i(this,"blockName");i(this,"blockEventCallbacks");i(this,"blockId","");i(this,"hostData",{});this.blockName=e,this.blockEventCallbacks=s,this._setupDefaultParams(),this._setupWindowEvents()}_setupDefaultParams(){const e=c.getUrlParams(g.BLOCK_ID);if(!e)throw new Error("Not a valid block iframe");e&&(this.blockId=e)}_onPostMessageReceived(e){var s,o,u,m,h;((s=e.data)==null?void 0:s.receivingBlockId)===this.blockId&&(((o=e.data)==null?void 0:o.type)===d.INCOME?this.blockEventCallbacks.onIncomingData&&this.blockEventCallbacks.onIncomingData(e.data,e.data.eventData):((u=e.data)==null?void 0:u.type)===d.CONTROLLER?this.blockEventCallbacks.onControllerData&&this.blockEventCallbacks.onControllerData(e.data,e.data.eventData):((m=e.data)==null?void 0:m.type)===d.ALX?this.blockEventCallbacks.onAlxData&&this.blockEventCallbacks.onAlxData(e.data,e.data.eventData):((h=e.data)==null?void 0:h.type)===d.HOST_DATA&&(this.hostData={...this.hostData,...e.data.eventData.payload},this.blockEventCallbacks.onHostDataUpdate&&this.blockEventCallbacks.onHostDataUpdate(e.data,this.hostData)))}_setupWindowEvents(){window.addEventListener("message",this._onPostMessageReceived.bind(this))}static register(e,s){return new b(e,s)}sendOutput(e,s){c.sendMessageToHost({senderBlockId:this.blockId,type:d.OUTPUT,namespace:`${this.blockId}-${e}`,blockName:this.blockName,source:{handleId:e},payload:{data:s}})}sendAlxMessage(e,s=C.DISPLAY_MESSAGE){c.sendMessageToHost({senderBlockId:this.blockId,type:d.ALX,namespace:w,blockName:this.blockName,payload:{data:e},eventData:{alxEventType:s}})}resizeObserver(e){c.domResizeObserver(e,this)}sendControllerMessage(e,s){c.sendMessageToHost({senderBlockId:this.blockId,type:d.CONTROLLER,blockName:this.blockName,payload:{...e},eventData:{controllerType:s}})}};i(b,"Utils",{...c});let p=b;(function(t){t.BlockSdk=p})(window)});
//# sourceMappingURL=block-sdk.umd.cjs.map
