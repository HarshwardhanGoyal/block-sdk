#!/usr/bin/env sh
# . "${0%/*}/h"

# Check if there are any test files present
if find . -name "*.test.js" -o -name "*.spec.js" | grep -q .; then
    echo "Running pnpm test..."
    pnpm test
    TEST_EXIT_CODE=$?
else
    echo "No test cases found. Skipping pnpm test."
    TEST_EXIT_CODE=0
fi

echo "Running pnpm build..."
pnpm build
BUILD_EXIT_CODE=$?

# Check if both commands were successful
if [ $TEST_EXIT_CODE -eq 0 ] && [ $BUILD_EXIT_CODE -eq 0 ]; then
    echo "All checks passed. Proceeding with commit."
    exit 0
else
    echo "Pre-commit checks failed."
    [ $TEST_EXIT_CODE -ne 0 ] && echo "pnpm test failed."
    [ $BUILD_EXIT_CODE -ne 0 ] && echo "pnpm build failed."
    exit 1
fi